/******************************************************************************
 * NanoH7 - UAV firmware base on RT-Thread
 * Copyright (C) 2023 - 2025 Althrone <mail>
 * 
 * @file    rt-thread\bsp\stm32\rcf-nano-h7\algorithm\pid.c
 * 
 * ref: Specification of <some UM RM or Datasheet>
 *****************************************************************************/

/******************************************************************************
 * includes
 *****************************************************************************/

#include "pid.h"

/******************************************************************************
 * private macros
 *****************************************************************************/

/******************************************************************************
 * pubilc variables
 *****************************************************************************/

//姿态
PidParamStruct g_roll_pid={0};
PidParamStruct g_pitch_pid={0};
PidParamStruct g_yaw_pid={0};

PidParamStruct g_roll_rate_pid={0};
PidParamStruct g_pitch_rate_pid={0};
PidParamStruct g_yaw_rate_pid={0};

//定高
PidParamStruct g_alt_rate_pid={0};
PidParamStruct g_alt_pid={0};

/******************************************************************************
 * private types
 *****************************************************************************/

/******************************************************************************
 * private variables
 *****************************************************************************/

/******************************************************************************
 * private functions declaration
 *****************************************************************************/

/******************************************************************************
 * pubilc functions definition
 *****************************************************************************/

void pid_inc(PidParamStruct* pid,double e)
{
    //更新ek ek-1 ek-2
    pid->ek_2=pid->ek_1;
    pid->ek_1=pid->ek;
    pid->ek=e;

    pid->out+=pid->p*(pid->ek-pid->ek_1)+
              pid->i*pid->ek+
              pid->d*(pid->ek-2*pid->ek_1+pid->ek_2);
    
    if(pid->out>pid->outmax)
        pid->out=pid->outmax;
    
    if(pid->out<pid->outmin)
        pid->out=pid->outmin;
}

/******************************************************************************
 * private functions definition
 *****************************************************************************/
